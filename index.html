
<!doctype html>
<html lang="pt">
<head>
  <meta charset="utf-8">
  <title>Natal 2025 ‚Äî Canvas + M√∫sica (tema Natal)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üéÑ</text></svg>">
  <style>
    :root {
      color-scheme: dark;
      --bg: #0f1115;
      --panel: #161a22;
      --panel-2: #11151b;
      --text: #e9f1ff;
      --muted: #cde2ffcc;
      --green: #3dbb66;
      --green-dark: #2b8b4b;
      --blue: #1e88e5;
      --blue-dark: #1565c0;
      --red: #e53935;
      --gold: #ffd166;
      --ring: #7ec8a5;
      --card-border: #334155;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --glow: 0 0 0 transparent;
    }

    @media (prefers-reduced-motion:no-preference) {
      :root { --glow: 0 0 24px rgba(125, 255, 185, .15); }
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; padding: 2rem;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:
        radial-gradient(1200px 600px at 10% -10%, rgba(255, 64, 129, .05), transparent 40%),
        radial-gradient(1000px 500px at 90% 0%, rgba(76, 175, 80, .08), transparent 40%),
        var(--bg);
      color: var(--text);
    }

    h1 {
      margin: 0 0 1rem;
      line-height: 1.1;
      font-weight: 750;
      letter-spacing: .2px;
      display: flex; align-items: center; gap: .6rem;
    }
    h1 .emoji { font-size: 1.35em; }

    .wrap {
      max-width: 1000px;
      margin: 0 auto;
    }

    /* Canvas container com moldura ‚Äúluzes de Natal‚Äù */
    .canvas-wrap {
      position: relative;
      width: 100%;
      max-width: 820px;
      margin: 0 auto 1rem;
      padding: 16px;
      border-radius: 16px;
      background: linear-gradient(180deg, var(--panel), var(--panel-2));
      border: 1px solid var(--card-border);
      box-shadow: var(--shadow), var(--glow);
      overflow: hidden;
    }
    canvas#stage {
      display: block;
      width: 100%;
      height: auto;
      max-height: 460px;
      aspect-ratio: 16/9;
      background: #0e1722;
      border-radius: 12px;
      border: 1px solid #223041;
      position: relative;
      z-index: 1;
    }

    /* cord√£o de luzes: pseudo-elementos top/bottom com ‚Äúbolinhas‚Äù a pulsar */
    .canvas-wrap::before,
    .canvas-wrap::after {
      content: "";
      position: absolute; left: 10px; right: 10px; height: 8px;
      background:
        radial-gradient(6px 6px at 6px 4px, #ff6b6b 60%, transparent 62%) 0 0/60px 100%,
        radial-gradient(6px 6px at 6px 4px, #ffd166 60%, transparent 62%) 20px 0/60px 100%,
        radial-gradient(6px 6px at 6px 4px, #69db7c 60%, transparent 62%) 40px 0/60px 100%,
        radial-gradient(6px 6px at 6px 4px, #4dabf7 60%, transparent 62%) 60px 0/60px 100%;
      opacity: .9;
      filter: drop-shadow(0 0 4px rgba(255,255,255,.25));
      animation: twinkle 2.6s infinite ease-in-out;
    }
    .canvas-wrap::before { top: 6px; }
    .canvas-wrap::after  { bottom: 6px; transform: scaleX(-1); }

    @keyframes twinkle {
      0%, 100% { opacity: .8; }
      50%      { opacity: 1; }
    }

    .actions { display: flex; gap: .75rem; flex-wrap: wrap; margin: .9rem 0; align-items: center; }
    button {
      padding: 0.75rem 1rem;
      font-size: 1rem;
      cursor: pointer;
      border: 0;
      border-radius: 12px;
      color: #fff;
      background: linear-gradient(180deg, var(--green), var(--green-dark));
      box-shadow: 0 8px 22px rgba(61,187,102,.25);
      display: inline-flex; gap: .55rem; align-items: center;
      transition: transform .08s ease, filter .2s ease;
    }
    button:hover { filter: brightness(1.05); }
    button:active { transform: translateY(1px) scale(.998); }
    button:disabled { opacity: .6; cursor: not-allowed; filter: grayscale(.15); }

    #pauseBtn {
      background: linear-gradient(180deg, var(--blue), var(--blue-dark));
      box-shadow: 0 8px 22px rgba(30,136,229,.25);
    }

    .pill {
      font-size: .8rem; font-weight: 600;
      padding: .2rem .5rem; border-radius: 999px;
      background: #17212b; color: var(--muted);
      border: 1px solid #273647;
    }

    audio {
      width: 100%;
      max-width: 820px;
      margin-top: .25rem;
      filter: drop-shadow(0 6px 14px rgba(0,0,0,.25));
      border-radius: 8px;
    }

    .card {
      margin-top: 1rem;
      padding: 1rem 1.2rem;
      border: 1px solid var(--card-border);
      border-radius: 14px;
      background: linear-gradient(180deg, #121720, #0f141c);
      box-shadow: var(--shadow);
    }
    .card h2 {
      margin: 0 0 .75rem; font-size: 1rem; letter-spacing: .3px; font-weight: 700;
      display: flex; align-items: center; gap: .6rem;
    }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; }
    .ok  { color: #9be4b6; }
    .err { color: #ff9b9b; }
    ul { margin: .25rem 0 0 .5rem; padding-left: 1rem; }

    /* badge de estado */
    #status {
      display: inline-block;
      padding: .25rem .6rem;
      border-radius: 999px;
      border: 1px solid #2a3848;
      background: #141a21;
      margin-left: .5rem;
    }

    /* Respeitar prefers-reduced-motion: pausa twinkle e neve */
    @media (prefers-reduced-motion: reduce) {
      .canvas-wrap::before, .canvas-wrap::after { animation: none; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h1><span class="emoji">üéÑ</span> Canvas ‚Äî tocar m√∫sica na mesma p√°gina <span class="pill">Tema Natal</span></h1>

    <div class="canvas-wrap">
      <canvas id="stage" width="1280" height="720" aria-label="Cen√°rio com neve animada"></canvas>
    </div>

    <div class="actions">
      <button id="playBtn" disabled aria-label="Tocar m√∫sica"><span>‚ñ∂Ô∏è</span><span>Tocar</span></button>
      <button id="pauseBtn" disabled aria-label="Pausar m√∫sica"><span>‚è∏Ô∏è</span><span>Pausar</span></button>
      <span class="pill" id="songName">Abraco‚Äëde‚ÄëNatal.mp3</span>
    </div>

    <audio id="audioPlayer" controls preload="auto" playsinline></audio>

    <div class="card" role="region" aria-live="polite" aria-atomic="true">
      <h2>Estado <span id="status" class="mono">A procurar o ficheiro MP3‚Ä¶</span></h2>
      <div class="mono">Base URL: <span id="baseUrl"></span></div>
      <div><strong>Caminhos testados:</strong>
        <ul id="tested"></ul>
      </div>
      <div class="mono">Escolhido: <span id="chosen"></span></div>
    </div>
  </div>

  <script>
    // === Auto-detec√ß√£o dos caminhos (mantido do teu c√≥digo) ===================
    const CANDIDATES = [
      'assets/music/Abraco-de-Natal.mp3',   // esperado (Pages)
      'assets/music/abraco-de-natal.mp3',   // tudo min√∫sculo
      'assets/Music/Abraco-de-Natal.mp3',   // pasta com M mai√∫sculo
      'assets/music/Abraco-de-Natal.MP3',   // extens√£o mai√∫scula
      'Abraco-de-Natal.mp3',                // raiz (fallback)
      'https://raw.githubusercontent.com/vendabraga-alt/Natal-2025-BTN/main/assets/music/Abraco-de-Natal.mp3' // RAW
    ];

    const baseUrl = location.origin + location.pathname.replace(/index\.html$/, '');
    const testedEl = document.getElementById('tested');
    const chosenEl = document.getElementById('chosen');
    const statusEl = document.getElementById('status');
    const songNameEl = document.getElementById('songName');

    const audio = document.getElementById('audioPlayer');
    const playBtn = document.getElementById('playBtn');
    const pauseBtn = document.getElementById('pauseBtn');

    const setStatus = (msg, cls) => {
      statusEl.textContent = msg;
      statusEl.className = 'mono ' + (cls || '');
      console.log('[Status]', msg);
    };
    document.getElementById('baseUrl').textContent = baseUrl;

    // === Desenho de fundo + NEVE no canvas ====================================
    const canvas = document.getElementById('stage');
    const ctx = canvas.getContext('2d');
    let W = canvas.width, H = canvas.height;

    function resizeCanvas() {
      // manter 16:9 mas respeitar densidade
      const dpr = Math.min(window.devicePixelRatio || 1, 2);
      const rect = canvas.getBoundingClientRect();
      canvas.width = Math.round(rect.width * dpr);
      canvas.height = Math.round(rect.width * 9/16 * dpr);
      W = canvas.width; H = canvas.height;
    }
    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);

    // part√≠culas de neve
    const flakes = [];
    const FLAKES = 140; // leve para performance
    function initSnow() {
      flakes.length = 0;
      for (let i = 0; i < FLAKES; i++) {
        flakes.push({
          x: Math.random() * W,
          y: Math.random() * H,
          r: 1 + Math.random() * 2.2,
          s: 0.3 + Math.random() * 0.9, // speed
          a: Math.random() * Math.PI * 2, // angle
        });
      }
    }
    initSnow();

    // fundo gradiente + mensagem
    function drawBackground() {
      const g = ctx.createLinearGradient(0, 0, 0, H);
      g.addColorStop(0, '#0c1520');
      g.addColorStop(1, '#0a1120');
      ctx.fillStyle = g;
      ctx.fillRect(0, 0, W, H);

      // brilhos suaves (estrelas)
      ctx.save();
      ctx.globalAlpha = .2;
      for (let i = 0; i < 50; i++) {
        const x = Math.random() * W, y = Math.random() * (H * .45);
        const r = Math.random() * 1.6;
        const g2 = ctx.createRadialGradient(x, y, 0, x, y, r * 4);
        g2.addColorStop(0, 'rgba(255,255,255,.9)');
        g2.addColorStop(1, 'rgba(255,255,255,0)');
        ctx.fillStyle = g2;
        ctx.beginPath(); ctx.arc(x, y, r * 4, 0, Math.PI * 2); ctx.fill();
      }
      ctx.restore();

      // mensagem
      ctx.fillStyle = '#dfffea';
      ctx.font = Math.max(18, Math.floor(H/24)) + 'px ui-rounded, system-ui, sans-serif';
      ctx.fillText('Clique em "Tocar" para reproduzir üé∂', Math.floor(W*0.05), Math.floor(H*0.85));
    }

    let lastTime = 0;
    function drawSnow(t) {
      // respeitar prefers-reduced-motion
      const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      const dt = Math.min(32, (t - lastTime) || 16);
      lastTime = t;

      drawBackground();

      ctx.save();
      ctx.fillStyle = '#ffffff';
      for (const f of flakes) {
        if (!prefersReduced) {
          f.y += f.s * dt * 0.06;
          f.x += Math.sin((f.y + f.a) * 0.008) * 0.4;
        }
        if (f.y > H + 5) { f.y = -5; f.x = Math.random() * W; }
        ctx.beginPath();
        ctx.arc(f.x, f.y, f.r, 0, Math.PI * 2);
        ctx.globalAlpha = 0.7;
        ctx.fill();
      }
      ctx.restore();

      requestAnimationFrame(drawSnow);
    }
    requestAnimationFrame(drawSnow);

    // === Auto-procura do MP3 ===================================================
    (async () => {
      for (const path of CANDIDATES) {
        const absolute = new URL(path, baseUrl).href;
        const li = document.createElement('li');
        li.className = 'mono';
        li.textContent = absolute + ' ‚Ä¶';
        testedEl.appendChild(li);

        try {
          const res = await fetch(absolute, { method: 'HEAD', cache: 'no-store' });
          li.textContent = absolute + ' ‚Üí ' + res.status;
          if (res.ok) {
            const chosen = absolute.includes('raw.githubusercontent.com')
              ? absolute
              : absolute + '?v=' + Date.now(); // cache-buster
            audio.src = chosen;
            chosenEl.textContent = chosen;
            setStatus('Encontrado ‚úÖ (' + res.status + '). Pronto para tocar.', 'ok');
            playBtn.disabled = false; pauseBtn.disabled = false;

            // Atualiza ‚Äúnome‚Äù do tema (s√≥ parte final do path)
            try { songNameEl.textContent = decodeURIComponent(new URL(chosen).pathname.split('/').pop()); } catch(e){}

            return;
          }
        } catch (e) {
          li.textContent = absolute + ' ‚Üí erro de rede';
        }
      }
      setStatus('‚ùå Nenhum dos caminhos respondeu 200. Corrige nome/pasta/caso no reposit√≥rio.', 'err');
    })();

    // === Controlo de reprodu√ß√£o ===============================================
    playBtn.addEventListener('click', async () => {
      try { await audio.play(); setStatus('A reproduzir ‚úÖ', 'ok'); }
      catch (e) { console.error(e); setStatus('N√£o foi poss√≠vel reproduzir (ver Console).', 'err'); }
    });
    pauseBtn.addEventListener('click', () => {
      audio.pause();
      setStatus('Pausado ‚è∏Ô∏è');
    });

    audio.addEventListener('playing', () => {
      // pequeno efeito no canvas-wrap quando est√° a tocar
      document.querySelector('.canvas-wrap').style.boxShadow =
        '0 10px 30px rgba(0,0,0,.35), 0 0 32px rgba(61,187,102,.18)';
    });
    audio.addEventListener('pause', () => {
      document.querySelector('.canvas-wrap').style.boxShadow =
        '0 10px 30px rgba(0,0,0,.35), 0 0 0 rgba(0,0,0,0)';
    });

    audio.addEventListener('loadedmetadata', () => {
      const dur = isFinite(audio.duration) ? audio.duration.toFixed(1) + 's' : 'desconhecida';
      setStatus('Carregado. Dura√ß√£o ~ ' + dur);
    });
    audio.addEventListener('error', () => setStatus('Erro no carregamento do √°udio.', 'err'));

  </script>
</body>
</
