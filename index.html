
<!doctype html>
<html lang="pt">
<head>
  <meta charset="utf-8">
  <title>Natal 2025 ‚Äî Canvas + M√∫sica (mesma p√°gina)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root { color-scheme: dark; }
    body { font-family: system-ui, Arial, sans-serif; margin: 0; padding: 2rem; background: #111; color: #eee; }
    h1 { margin: 0 0 1rem; }
    canvas { display: block; border: 2px solid #444; background: #222; margin-bottom: 1rem; width: 640px; height: 360px; }
    .actions { display: flex; gap: .75rem; flex-wrap: wrap; margin-bottom: .75rem; }
    button {
      padding: 0.75rem 1rem;
      font-size: 1rem;
      cursor: pointer;
      border: 0;
      border-radius: 10px;
      background: #2e7d32;
      color: #fff;
      box-shadow: 0 6px 16px rgba(0,0,0,.35);
    }
    button:hover { background: #1b5e20; }
    button:disabled { opacity: .6; cursor: not-allowed; }
    #pauseBtn { background: #1e88e5; }
    #pauseBtn:hover { background: #1565c0; }
    audio { width: 100%; max-width: 720px; margin-top: .5rem; }

    .card {
      margin-top: .75rem;
      padding: .75rem 1rem;
      border: 1px solid #444;
      border-radius: 10px;
      background: #1a1a1a;
      font-size: .95rem;
    }
    .ok  { color: #9ccc65; }
    .err { color: #ef5350; }
    .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; }
  </style>
</head>
<body>
  <h1>Canvas ‚Äî tocar m√∫sica na mesma p√°gina</h1>

  <canvas id="stage" width="640" height="360"></canvas>

  <div class="actions">
    <button id="playBtn" disabled>Tocar üéµ</button>
    <button id="pauseBtn" disabled>Pausar ‚è∏Ô∏è</button>
  </div>

  <audio id="audioPlayer" controls preload="auto" playsinline></audio>

  <div class="card">
    <div><strong>Estado:</strong> <span id="status">A verificar MP3‚Ä¶</span></div>
    <div class="mono">Base URL: <span id="baseUrl"></span></div>
    <div class="mono">MP3 path: <span id="mp3Path"></span></div>
    <div class="mono">MP3 request: <span id="mp3Req"></span></div>
    <div class="mono">Audio src final: <span id="audioSrc"></span></div>
  </div>

  <script>
    // ===== CONFIG =====
    // üëâ Caminho relativo exato do ficheiro no reposit√≥rio
    const MP3_PATH = 'assets/music/Abraco-de-Natal.mp3';

    // ===== CANVAS (apenas visual) =====
    const canvas = document.getElementById('stage');
    const ctx = canvas.getContext('2d');
    ctx.fillStyle = '#4CAF50';
    ctx.fillRect(20, 20, 200, 120);
    ctx.fillStyle = '#eee';
    ctx.font = '20px sans-serif';
    ctx.fillText('Clique em "Tocar üéµ" para reproduzir a m√∫sica', 20, 170);

    // ===== ELEMENTOS =====
    const audio   = document.getElementById('audioPlayer');
    const playBtn = document.getElementById('playBtn');
    const pauseBtn= document.getElementById('pauseBtn');
    const statusEl= document.getElementById('status');
    const baseEl  = document.getElementById('baseUrl');
    const pathEl  = document.getElementById('mp3Path');
    const reqEl   = document.getElementById('mp3Req');
    const srcEl   = document.getElementById('audioSrc');

    const baseUrl = location.origin + location.pathname.replace(/index\.html$/, '');
    baseEl.textContent = baseUrl;
    pathEl.textContent = MP3_PATH;

    const setStatus = (msg, cls) => {
      statusEl.textContent = msg || '';
      statusEl.className = cls || '';
      console.log('[Player]', msg);
    };

    // ===== Verificar o MP3 (HEAD) + preparar src =====
    (async () => {
      try {
        const absoluteHeadUrl = new URL(MP3_PATH, baseUrl).href;
        reqEl.textContent = absoluteHeadUrl;

        const r = await fetch(MP3_PATH, { method: 'HEAD', cache: 'no-store' });
        if (!r.ok) {
          throw new Error(`MP3 n√£o encontrado. HTTP ${r.status}. Verifique nome/pasta/caso.`);
        }

        // cache-buster para evitar servir vers√£o antiga
        const finalSrc = MP3_PATH + '?v=' + Date.now();
        audio.src = finalSrc;
        audio.preload = 'auto';

        srcEl.textContent = new URL(finalSrc, baseUrl).href;
        setStatus('MP3 encontrado (200). Pronto para tocar.', 'ok');

        playBtn.disabled = false;
        pauseBtn.disabled = false;
      } catch (err) {
        console.error(err);
        setStatus('‚ùå ' + err.message, 'err');
        srcEl.textContent = '(n√£o definido ‚Äî erro ao localizar ficheiro)';
        playBtn.disabled = true;
        pauseBtn.disabled = true;
      }
    })();

    // ===== Controlos =====
    playBtn.addEventListener('click', async () => {
      try {
        await audio.play();   // gesto do utilizador na MESMA aba ‚Üí permitido
        setStatus('A reproduzir ‚úÖ', 'ok');
      } catch (err) {
        console.error(err);
        setStatus('N√£o foi poss√≠vel reproduzir. Abra F12 ‚Üí Console/Network.', 'err');
      }
    });

    pauseBtn.addEventListener('click', () => {
      audio.pause();
      setStatus('Pausado ‚è∏Ô∏è');
    });

    audio.addEventListener('loadedmetadata', () => {
      const dur = isFinite(audio.duration) ? audio.duration.toFixed(1) + 's' : 'desconhecida';
      setStatus('Carregado. Dura√ß√£o: ' + dur);
    });
    audio.addEventListener('error', () => setStatus('Erro ao carregar √°udio (Network/Console).', 'err'));
    audio.addEventListener('ended', () => setStatus('Terminou a reprodu√ß√£o.'));
  </script>
</</body>


